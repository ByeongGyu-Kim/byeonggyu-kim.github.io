---
title: "High Dynamic Range Imaging"
date: 2025-05-19 18:00:00 +0900
categories:
  - Imaging Photography
tags:
  - Vision
description: 
toc: true
comments: false
cdn: 
image:
math: true
pin: false
mermaid: false
---


## 📸 다이내믹 레인지(Dynamic Range)

실제 세계는 매우 넓은 밝기 범위를 가진다. 아래의 표와 같이 우리가 바라보고 마주하는 장면은 **수억 배에 이르는 밝기 차이**를 포함하고 있다.

| 환경                      | 상대 밝기 |
|---------------------------|-----------|
| 어두운 방 🛏️             | 1         |
| 밝은 사무실 💡           | 1,500     |
| 흐린 날 야외 🌥️          | 25,000    |
| 맑은 날 야외 ☀️          | 400,000   |
| 태양을 직접 볼 때 🌞     | 2,000,000,000 |

이러한 실제 세계는 매우 높은 **다이내믹 레인지(Dynamic Range, DR)**를 가진다고 우리는 말한다.  
이 때 DR, Dynamic Range는 **가장 밝은 빛과 가장 어두운 빛의 비율**로 정의되며, 우리 세상은 큰 DR을 가진다고 말할 수 있는 것이다.

그럼 디지털 카메라을 통해 사진 촬영을 할 때에는 어떤 상황이 발생하게 되는 걸까?
당연하게도 디지털 카메라는 현실 세계보다 훨씬 좁은 범위의 밝기만을 표현할 수 있다.
그렇기에 같은 장면을 서로 다른 **셔터 속도**로 촬영하면 아래과 같은 결과가 나타난다.

![Desktop View](/assets/img/imaging_photography/chap16_1.png)
_Figure 1: 다양한 Shutter speed에 측정 intensity 모식도_

- **1초** ⏱️ : 어두운 영역은 잘 보이지만 밝은 영역은 **하얗게 날아감 (clipping)**
- **0.5초** : 중간 수준의 균형, 하지만 여전히 일부 밝은 영역이 clipping
- **0.25초** : 밝은 영역은 잘 표현되지만 어두운 영역은 어둡게 뭉개짐

➡️ 즉, 한 장의 사진으로는 전체 장면의 밝기 정보를 **완전하게 담을 수 없음**을 알 수 있다.

### ⚙️ RAW 이미지와 선형성

디지털 카메라의 **RAW 이미지**는 실제 장면의 밝기와 **선형적 관계**를 가진다.

$$
\text{픽셀 값} \propto \text{장면의 밝기 (radiance)}
$$

하지만,
- 노출 시간이 길면 밝은 부분이 **포화되어(clipping)** 정보가 사라지고,
- 노출 시간이 짧으면 어두운 부분이 **너무 어두워져** 정보가 사라진다.

---

### ⚠️ 4. 노출을 줄이면 밝은 영역을 표현할 수 있지만, 어두운 영역은 계조 손실 발생

짧은 노출 시간은 **밝은 영역의 포화(clipping)를 방지**해 준다.  
하지만 그만큼 **어두운 영역의 빛이 적게 들어와**, 디지털 센서가 이를 제대로 표현하지 못한다.

📉 디지털 센서는 밝기를 **일정한 단계(quantization step)**로 나누어 표현하므로,  
빛이 적게 들어오는 어두운 영역에서는:

- 표현 가능한 단계 수가 적어지고,
- 결과적으로 **계조 간격이 커지며**, 디테일 손실이 발생한다.

---

### 👁️ 5. 사람의 눈은 밝기에 따라 민감도가 다르다

- 사람의 눈은 **어두운 영역에서는 민감도 ↑**, **밝은 영역에서는 민감도 ↓**
- 따라서 밝은 부분의 계조 손실은 잘 인지하지 못하고,
- 어두운 부분의 손실은 **더 쉽게 인식**

➡️ 디지털 이미지가 **사람의 실제 지각과 다르게 보이는 이유**

---

### 💻 6. 디지털 장치의 다이내믹 레인지 vs 실제 세계

다양한 디지털 매체 및 장치들이 지원하는 **다이내믹 레인지**는 다음과 같다:

| 장치/매체                 | 대략적인 DR 비율 |
|---------------------------|-----------------|
| 사진 인화지 🖨️           | 10:1            |
| 예술용 페인트 🎨          | 20:1            |
| 슬라이드 필름 📽️         | 200:1           |
| 네거티브 필름 📷          | 500:1           |
| LCD 디스플레이 💻         | 1,000:1         |
| 디지털 SLR (12bit) 📸     | 2,000:1         |
| **실제 세계** 🌞          | **100,000:1 이상** |

➡️ **센서도 디스플레이도 현실 세계의 밝기 범위를 모두 다룰 수 없음**  
➡️ 그래서 **HDR (High Dynamic Range)** 기술이 필요하다

---


## 🌈 HDR 이미지 생성과 톤 매핑 (Tone Mapping)

---

### 🧩 1. HDR 이미지란?

디지털 카메라는 하나의 노출로 **모든 밝기 정보를 담을 수 없다**.  
그래서 **여러 장의 서로 다른 노출 이미지를 병합**해서,  
밝은 영역과 어두운 영역 모두의 디테일을 담는 **HDR 이미지**를 만든다.

---

### 🧪 2. HDR 이미지 생성 절차

#### 📷 Step 1: Exposure Bracketing (다중 노출 촬영)

- 같은 장면을 여러 번 촬영하되, **셔터 속도만 다르게** 한다.
- 예: 1초, 0.5초, 0.25초 등
- 각각의 이미지가 **다른 밝기 범위**의 정보를 보존함

#### 🔗 Step 2: 이미지 병합 (HDR Merge)

- 각 픽셀마다 **유효한 범위의 값**을 선택 (예: 0.05 < 픽셀 < 0.95)
- 노출 시간으로 정규화:  
  $$ \text{정규화된 픽셀값} = \frac{I(x, y)}{t_i} $$
- 여러 노출에서 정규화된 픽셀값들을 **평균**하여 최종 HDR 픽셀 생성

➡️ 이렇게 병합된 이미지는 **넓은 다이내믹 레인지를 가지는 HDR 이미지**가 된다.

---

### ⚠️ 3. 그런데 HDR 이미지는 그냥 디스플레이에 보여줄 수 없다

💻 대부분의 디스플레이는 **낮은 다이내믹 레인지 (LDR)**만 표현 가능함  
➡️ 그래서 **HDR 이미지를 압축(톤 매핑)**해서 보여줘야 한다.

---

## 🧰 4. Tone Mapping (톤 매핑)

### 📏 방법 1: Linear Scaling (선형 스케일링)

- 가장 간단한 방법:  
  $$ \text{출력} = \frac{\text{입력} - \min}{\max - \min} \times 255 $$
- 밝기 값 전체를 0~255 범위로 단순하게 정규화

❌ 하지만 이 방법은 **밝은 영역이나 어두운 영역의 디테일을 잃어버림**

---

### 📷 방법 2: Photographic Tone Mapping (사진 스타일 톤 매핑)

- 전체 이미지에 **비선형 함수**를 적용해 **밝기 분포를 조절**
- 특징:
  - 어두운 영역은 그대로 유지 (slope ≈ 1 near 0)
  - 밝은 영역은 천천히 **비포화(asymptote)** 시켜 clipping 방지
- 실제 사진 필름의 반응을 모방 (film response curve)

➡️ 시각적으로 자연스러우며, **사람의 지각 특성**을 반영

---

### 🔍 수식 구조 (단순화):

$$
I_{\text{mapped}} = \frac{I}{I + 1}
$$

- 밝은 영역은 **1에 수렴** (더 이상 밝아지지 않음)
- 어두운 영역은 **거의 그대로 유지**

---

### 🧪 예시

| 이미지 | 설명 |
|--------|------|
| 낮은 노출 이미지 | 어두운 부분 보이지만 밝은 부분은 까맣게 |
| 높은 노출 이미지 | 밝은 부분은 보이지만 어두운 부분은 날아감 |
| 📸 **HDR + Photographic TM** | 양쪽 모두 디테일 보존, 자연스러움 |

---

✅ 여기까지가 HDR 이미지 생성과 기본적인 톤 매핑 방법의 핵심입니다.  
다음 슬라이드들에서는 색 처리와 더 고급 톤 매핑 기법들이 등장합니다.



## 🎨 색 보존과 저주파 기반 톤 매핑

---

### 🖼️ 1. Photographic Tone Mapping의 예시

Photographic tone mapping은 선형 스케일링보다 **훨씬 자연스럽고 현실적인 결과**를 제공한다.

- 밝은 영역과 어두운 영역 모두 디테일을 유지
- 기존 LDR 이미지를 뛰어넘는 품질 제공
- 하지만 이 방식에도 단점이 있음: **색상이 희미해지거나, 대비가 약해지는 현상**

---

### 🎨 2. 색상 처리의 문제점

#### 문제 상황:
Photographic tone mapping을 RGB 채널에 **동일하게 적용**하면,
- 전체 색상이 **회색빛으로 탈색(Washed out)** 되는 느낌 발생

#### 원인:
- 모든 채널을 동일하게 조정하면 **색의 비율이 왜곡**
- 색상 고유의 채도가 손실됨

---

### 🎯 해결책 1: Intensity-only Tone Mapping

- 먼저 이미지를 **intensity (밝기)**와 **색상 정보(chroma)**로 분리
- 톤 매핑은 오직 **밝기(intensity)**에만 적용
- 색상은 **원래의 색 비율을 유지**

#### 장점:
- 색상 유지됨 ✅

#### 단점:
- 경우에 따라서는 **디테일이나 대비가 약해질 수 있음** ❌

---

### 🧠 해결책 2: Low-Frequency Intensity-Only Tone Mapping

더 고급 방법:  
이미지를 **저주파(low-frequency) + 고주파(high-frequency)** 성분으로 나누고,  
- 저주파 성분에만 tone mapping 적용
- 고주파 성분(디테일)은 그대로 유지

📌 수식 구조 (개념적으로):

$$
\text{Final Image} = \text{ToneMapped(Low-Freq)} + \text{High-Freq}
$$

#### 장점:
- 색상 유지 + 디테일 보존 + 대비 유지
- 밝기 조절은 부드럽게, 디테일은 날카롭게

---

### 🔍 Low-Freq / High-Freq 분리란?

- **Low-Freq**: 조명/밝기 같은 큰 구조  
- **High-Freq**: 텍스처, 윤곽선, 세부 디테일

이 둘을 분리해서 **밝기만 조정**하고 **디테일은 그대로 유지**하는 것이 핵심

---

### ⚖️ 비교 예시

| 기법                          | 색상 유지 | 디테일 유지 | 단점                  |
|-------------------------------|-----------|--------------|------------------------|
| RGB에 tone mapping            | ❌         | ✅           | 색상 손실              |
| Intensity-only tone mapping   | ✅         | ❌           | 디테일 손실            |
| Low-freq tone mapping         | ✅         | ✅           | 🎯 하지만 "halo" 문제 발생 가능 |

---

### ⚠️ Halo Artifact 문제

저주파 tone mapping은 이미지 경계 근처에서 **밝기 차이의 부자연스러운 흐림 현상**, 즉  
**"halo" 아티팩트**가 생길 수 있다. (밝은 테두리처럼 보이는 현상)

➡️ 다음 단계에서는 이를 해결하기 위해 **Bilateral Filtering**을 적용한다.

## 🧠 고급 톤 매핑과 HDR의 주의점, 그리고 현재의 활용

---

### 🧼 1. Halo 문제 해결: Bilateral Filtering 기반 톤 매핑

저주파 톤 매핑은 디테일과 색상을 잘 유지하지만,  
**경계 부분에서 흐릿한 테두리(Halo artifacts)**가 생기는 문제가 있다.

#### 💡 해결책: Bilateral Filter 사용

- Bilateral filter는 **경계는 유지하면서 부드럽게** 이미지를 흐림
- 결과적으로 **halo를 줄이면서 디테일과 색상도 유지 가능**

📌 핵심 아이디어:
- 저주파 성분을 만들되 **경계(edge)를 흐리지 않는 방식**으로 분리

---

### 🔍 2. 비교 결과

| 기법                         | 색상 유지 | 디테일 유지 | Halo 제거 | 전체 인상 |
|------------------------------|-----------|--------------|------------|------------|
| RGB 톤 매핑                  | ❌         | ✅           | ✅         | 색상 탈색 |
| Intensity-only tone mapping  | ✅         | ❌           | ✅         | 뿌연 인상 |
| Low-freq tone mapping        | ✅         | ✅           | ❌         | Halo 발생 |
| 🎯 Bilateral tone mapping    | ✅         | ✅           | ✅         | 👌 가장 균형 잡힘 |

---

### 📌 3. HDR과 톤 매핑에 대한 주의사항

#### ✅ HDR은 강력한 기술이다

- 어두운 곳과 밝은 곳의 디테일을 모두 살릴 수 있음
- 실제 인간의 시각에 가까운 이미지 생성 가능

#### ⚠️ 하지만 오용도 많다

- Tone Mapping을 과하게 사용하면 **비현실적이고 눈에 거슬리는 이미지**가 됨
- HDR 자체가 문제가 아니라, **Tone Mapping 알고리즘 선택과 매개변수 조정이 핵심**

---

### 🤖 4. 현대 HDR 기술: 스마트폰도 한다!

오늘날 대부분의 스마트폰 카메라는 **자동 HDR** 기능을 내장하고 있다.

- 여러 장의 이미지를 자동으로 촬영하고, 실시간으로 병합
- 대표적 사례: **Google HDR+**
  - 이 기술은 실제로 **SIGGRAPH/SIGGRAPH Asia 논문으로 발표**됨
  - 연구 수준의 기술이 실제 제품에 반영된 대표적인 예시

---

### 🧵 5. 핵심 요약

- 디지털 카메라의 제한된 DR은 현실 세계를 정확히 담지 못함
- HDR 기술은 여러 노출 이미지를 병합하여 이 문제를 해결
- Tone Mapping은 HDR을 실제 디스플레이에서 표현하기 위한 핵심 과정
- 여러 기법이 존재하며, **디테일 보존, 색상 유지, 아티팩트 방지 사이의 균형이 중요**
- 현대에는 스마트폰도 HDR을 잘 활용하고 있으며, 연구가 활발히 진행 중

---

## 🙋 Q&A로 마무리
